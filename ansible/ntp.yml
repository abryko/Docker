---
#
##
### Written by the CAT (Cloudwatt Automation Team)
##
#
- hosts: servers
  user: cloud
  become: yes

  vars:
    package: ntp

  tasks:
     - name : install NTP
       apt: pkg=ntp
           state=present

     - name : install httplib2
       pip: name=httplib2
           state=present

     - name: config ntp client
       lineinfile:
        dest=/etc/ntp.conf
        line="server {{toolbox_address}}"

     - uri:
         url: http://{{ toolbox_address }}:2379/v2/keys/servers/{{ openstack_id }}/apps/ntpserver
         method: PUT
         HEADER_Content-Type: "application/x-www-form-urlencoded"
         status_code: 200,201
         body_format: raw
         body: "value={{ package }}"
